<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Principal Details</title>
    <link rel="stylesheet" href="principal.css">
</head>

<body>
    <nav>
        <img src="image-removebg-preview.png" id="logo" alt="Logo">
        <p class="lo" style="font-size: 22px;">
            <span style="color: crimson; font-size: 30px;">D</span>PS
        </p>
        <div class="nav-links">
            <ul>
                <li><a href="index.html">HOME</a></li>
                <li><a href="gallery.html">ABOUT</a></li>
                <li><a href="principal.html">CONTACT</a></li>
            </ul>
        </div>
    </nav>
    <section class="header">
        <div class="event">
            <h3>PRINCIPAL DETAILS</h3>
            <div class="text">
                <img src="" id="profile" alt="Profile Image">
                <div class="labels">
                    <label for="name">Name: <span id="principalName"></span></label><br>
                    <label for="empid">Employee ID: <span id="principalEmpId"></span></label><br>
                    <label for="phone">Phone: <span id="principalPhone"></span></label>
                </div>
            </div>
        </div>
        <div class="parent" id="parent1">
            <div class="det">
                <div class="att" onclick="toggleDivs()">
                    <div class="main-d">
                        <p>Make Notice</p>
                        <img src="hand.png" alt="">
                    </div>
                    <div class="bottom">
                        <p>More Info <i class="fa-solid fa-arrow-right"></i></p>
                    </div>
                </div>
                <div class="mark" onclick="toggleDivs2()">
                    <div class="main-d">
                        <p>Add Teacher</p>
                        <img src="hat.png" alt="">
                    </div>
                    <div class="bottom">
                        <p>More Info <i class="fa-solid fa-arrow-right"></i></p>

                    </div>
                </div>
                <div class="ass" onclick="toggleDivs3()">
                    <div class="main-d">
                        <p>Set Time Table</p>
                        <img src="book.png" alt="">
                    </div>
                    <div class="bottom">
                        <p>More Info <i class="fa-solid fa-arrow-right"></i></p>
                    </div>
                </div>
            </div>
            <div class="tab">
                <div class="timetable-container">
                    <h2><i class="fa fa-calendar"></i> Today's Time Table</h2>
                    <div class="dropdown">
                        <select id="select-day">
                            <option value="" disabled selected>Select Day</option>
                            <option value="monday">Monday</option>
                            <option value="tuesday">Tuesday</option>
                            <option value="wednesday">Wednesday</option>
                            <option value="thursday">Thursday</option>
                            <option value="friday">Friday</option>
                            <option value="saturday">Saturday</option>
                        </select>
                    </div>
                    <table class="timetable">
                        <thead>
                            <tr>
                                <th>Subject</th>
                                <th>Type</th>
                                <th>From Time</th>
                                <th>To Time</th>
                                <th>Day</th>
                                <th>Faculty</th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ISC</td>
                                <td>Theory</td>
                                <td>8:00 AM</td>
                                <td>9:00 AM</td>
                                <td>Thursday</td>
                                <td>MR. ASHUTOSH MALLIK</td>
                                <td>RDB-08</td>
                            </tr>
                            <tr>
                                <td>OS</td>
                                <td>Theory</td>
                                <td>9:00 AM</td>
                                <td>10:00 AM</td>
                                <td>Thursday</td>
                                <td>Mr. Santosh Kumar Panda</td>
                                <td>RDB-08</td>
                            </tr>
                            <tr>
                                <td>EEC</td>
                                <td>Theory</td>
                                <td>12:20 PM</td>
                                <td>1:20 PM</td>
                                <td>Thursday</td>
                                <td>P. NARASIMHA MURTY</td>
                                <td>RDB-08</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="parent attendance" id="parent2">
            <div class="con">
                <h1>NOTICE</h1>
                <form id="inputForm">
                    <input type="text" id="textInput" placeholder="Enter some text" required>
                    <div id="textList"></div>
                    <button type="submit" id="sub">Submit</button>
                </form>
            </div>
        </div>
        <div class="parent attendance" id="parent3">
            <div class="parent">
                <h1>Add or Update Teacher</h1>
                <form id="teacherForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="teacherName">Name:</label>
                        <input type="text" id="teacherName" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacherEmpId">Employee ID:</label>
                        <input type="text" id="teacherEmpId" name="empid" required>
                    </div>
                    <div class="form-group">
                        <label for="teacherClass">Class Assigned:</label>
                        <input type="text" id="teacherClass" name="cls_assign" required>
                    </div>
                    <div class="form-group">
                        <label for="teacherPhone">Phone:</label>
                        <input type="text" id="teacherPhone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="teacherImg">Profile Image:</label>
                        <input type="file" id="teacherImg" name="img">
                    </div>
                    <div class="buton">
                        <button type="submit">Submit</button>
                    </div>
                </form>
                <div id="error-message" style="color: red;"></div>
            </div>
        </div>
        <div class="parent attendance" id="parent4">

        </div>
    </section>

    <script>
        // Fetch Principal Details using the ID from the URL
        async function fetchPrincipalDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const principalId = urlParams.get('id');  // Extract 'id' parameter from URL

            if (!principalId) {
                alert('No principal ID provided');
                return;
            }

            try {
                // Fetch principal details from the server
                const response = await fetch(`http://localhost:3001/principals/${principalId}`);
                if (response.ok) {
                    const principal = await response.json();
                    // Populate the page with fetched principal details
                    document.getElementById('principalName').textContent = principal.name;
                    document.getElementById('principalEmpId').textContent = principal.empid;
                    document.getElementById('principalPhone').textContent = principal.phone;
                    if (principal.img) {
                        document.getElementById('profile').src = principal.img;  // Set profile image
                    } else {
                        document.getElementById('profile').alt = 'No profile image';  // Placeholder if no image
                    }
                } else {
                    alert('Failed to load principal details');
                }
            } catch (error) {
                alert('An error occurred while fetching principal details');
            }
        }

        window.onload = fetchPrincipalDetails;  // Call function on page load
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('teacherForm');
            const errorMessage = document.getElementById('error-message');

            form.addEventListener('submit', async (event) => {
                event.preventDefault(); // Prevent the form from submitting normally

                const formData = new FormData(form);
                const teacherId = form.getAttribute('data-teacher-id'); // Assume teacherId is set when updating
                const isUpdate = !!teacherId;
                const method = isUpdate ? 'PUT' : 'POST';
                const url = isUpdate ? `/teachers/${teacherId}` : '/teachers';

                try {
                    const response = await fetch(url, {
                        method: method,
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error(`Error: ${response.statusText}`);
                    }

                    const result = await response.json();

                    // Handle success (you can add more logic to update the UI accordingly)
                    if (isUpdate) {
                        alert('Teacher updated successfully!');
                    } else {
                        alert('Teacher added successfully!');
                    }

                    // Clear the form or reset form state
                    form.reset();
                    form.removeAttribute('data-teacher-id');

                } catch (error) {
                    // Handle error
                    errorMessage.textContent = error.message;
                }
            });
        });


    </script>
    <script>
        const inputForm = document.getElementById('inputForm');
        const textInput = document.getElementById('textInput');
        const textList = document.getElementById('textList');

        inputForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const text = textInput.value;

            // Get existing texts from local storage
            let texts = JSON.parse(localStorage.getItem('userTexts')) || [];

            // Add new text to the array
            texts.push(text);

            // Save the updated array back to local storage
            localStorage.setItem('userTexts', JSON.stringify(texts));

            // Clear the input field
            textInput.value = '';

            // Update the displayed list
            displayTexts();
        });

        function displayTexts() {
            textList.innerHTML = '';
            const texts = JSON.parse(localStorage.getItem('userTexts')) || [];

            texts.forEach((text, index) => {
                const textItem = document.createElement('div');
                textItem.classList.add('text-item');

                const textContent = document.createElement('span');
                textContent.textContent = text;

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = () => deleteText(index);

                textItem.appendChild(textContent);
                textItem.appendChild(deleteButton);
                textList.appendChild(textItem);
            });
        }

        function deleteText(index) {
            let texts = JSON.parse(localStorage.getItem('userTexts')) || [];
            texts.splice(index, 1);
            localStorage.setItem('userTexts', JSON.stringify(texts));
            displayTexts();
        }

        // Display texts on page load
        window.addEventListener('load', displayTexts);

    </script>
    <script>
        function toggleDivs() {
            const parent1 = document.getElementById('parent1');
            const parent2 = document.getElementById('parent2');

            parent2.style.display = "flex";
            parent1.style.display = "none";
            document.getElementById('rol').textContent = document.getElementById('studentRollNo').textContent;
        }

        function toggleDivs2() {
            const parent1 = document.getElementById('parent1');
            const parent3 = document.getElementById('parent3');

            parent3.style.display = "flex";
            parent1.style.display = "none";
        }

        function toggleDivs3() {
            const parent1 = document.getElementById('parent1');
            const parent4 = document.getElementById('parent4');

            parent4.style.display = "flex";
            parent1.style.display = "none";
        }

    </script>

</body>

</html>